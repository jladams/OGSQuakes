<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8"/>
		<title>OK Earthquakes</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
        <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="leaflet.markercluster.js" type="text/javascript"></script>
  		<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
  		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- 	Links to static data -->
  		<script src="data/quakes2005.js" type="text/javascript"></script>
  		<script src="data/quakes2006.js" type="text/javascript"></script>
  		<script src="data/quakes2007.js" type="text/javascript"></script>
  		<script src="data/quakes2008.js" type="text/javascript"></script>
  		<script src="data/quakes2009.js" type="text/javascript"></script>
  		<script src="data/quakes2010.js" type="text/javascript"></script>
  		<script src="data/quakes2011.js" type="text/javascript"></script>
  		<script src="data/quakes2012.js" type="text/javascript"></script>
  		<script src="data/quakes2013.js" type="text/javascript"></script>
  		<script src="data/quakes2014.js" type="text/javascript"></script>
  		<script src="data/quakes2015.js" type="text/javascript"></script>
        <script src="data/faults.js" type="text/javascript"></script>

<!--	Styles -->
		<link rel="stylesheet" href="styles/style.css" />        
		<link rel="stylesheet" href="styles/MarkerCluster.css" />
		<link rel="stylesheet" href="styles/MarkerCluster.Default.css" />
  		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	</head>

	<body>			
		<div id="map"></div>

<!-- 	Credits -->
		<div class="modal fade" id="credits" role="dialog">
    		<div class="modal-dialog">
          			<div class="modal-content">
        			<div class="modal-header">
          				<button type="button" class="close" data-dismiss="modal">&times;</button>
          				<h4 class="modal-title">Credits</h4>
        			</div>
        			<div class="modal-body">
						<h4>This map is the result of a collaboration between the <a href="http://www.ou.edu/ogs" target="_blank">Oklahoma Geological Survey</a> and the <a href="http://libraries.ou.edu" target="_blank">University of Oklahoma Libraries</a></h4>
        				</br>
        				<p><strong>Map-Making Library:</strong></p>
        				<p><a href="http://www.leafletjs.com" target="_blank">Leaflet.js</a></p>
        				</br>
          				<p><strong>Map Base Tiles:</strong></p>
          				<p>Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community</p>
        				</br>
        				<p><strong>Clustering Plugin:</strong></p>
        				<p><a href="https://github.com/Leaflet/Leaflet.markercluster" target="_blank">Leaflet.markercluster</a> &copy; 2012 Dave Leaver, smartrak</p>
        				</br>
        				<p><strong>Earthquake Data:</strong></p>
        				<p><a href="http://earthquake.usgs.gov/" target="_blank">US Geological Survey</a><p>
        				<p><a href="http://www.ou.edu/ogs" target="_blank">Oklahoma Geological Survey</a><p>        				
        			</div>
        			<div class="modal-footer">
          				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        			</div>
      			</div>
    		</div>
		</div>
		<script>
//			Create map and set initial view			
		    var map = L.map('map').setView([35.4, -98], 7);

//			Base tiles
            var Esri_WorldTopoMap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 14,
	            attribution: 'Tiles &copy; Esri &mdash; <a data-toggle="modal" data-target="#credits">Credits</a>'
            }).addTo(map);
            
        	// Faults - calculating all these points slows down the map, so consider creating an image overlay instead
            var faults = L.geoJson(faults, {
                weight: 2,
                color: "red"
            });
            						    

//			Retrieves latest earthquake data from USGS - Commented lines retrieve it from OGS		    
		    $.getJSON(
		    // USGS Site:
		    "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson",
		    // OGS Site: 
		    // "http://wichita.ogs.ou.edu/eq/catalog/past7days/past7days.json",
		    function(data) {
				load7days(data);
	    	});
	    	
		    $.getJSON(
		    //USGS Site:
		    "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson",
		    // OGS Site: 
		    // "http://wichita.ogs.ou.edu/eq/catalog/past30days/past30days.json", 
		    function(data) {
				load30days(data);
			});
			
		    $.getJSON(
		    "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson",
		    // OGS Site: 
		    // "http://wichita.ogs.ou.edu/eq/catalog/past24hours/past24hours.json", 
		    function(data) {
				load1day(data);
		    });

//			Historical Quake Data from Oklahoma
			var quakes2008 = L.geoJson(quake2008, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2009 = L.geoJson(quake2009, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2010 = L.geoJson(quake2010, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2011 = L.geoJson(quake2011, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2012 = L.geoJson(quake2012, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2013 = L.geoJson(quake2013, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2014 = L.geoJson(quake2014, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });
			var quakes2015 = L.geoJson(quake2015, {
     	    	onEachFeature: function (feature, layer) {
     	    		temp = new Date(feature.properties.time);
    		    	layer.bindPopup("Date/Time: " + feature.properties.origintime + "</br>Magnitude: " + feature.properties.prefmag, {
    		    		autoPan: true
         			})
         		},
         		pointToLayer: function (feature, latlng) {
         			return L.circleMarker(latlng, {
         		    	radius: feature.properties.prefmag * 5,
         		        fillColor: "#ff7800",
         		        color: "#000"
        		    }
     			)}
 	        });

//			Add Layers to Clusters
     		var cluster2008 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2008.addLayer(quakes2008);
     		var cluster2009 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2009.addLayer(quakes2009);
     		var cluster2010 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2010.addLayer(quakes2010);
     		var cluster2011 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2011.addLayer(quakes2011);
     		var cluster2012 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2012.addLayer(quakes2012);
     		var cluster2013 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2013.addLayer(quakes2013);
     		var cluster2014 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2014.addLayer(quakes2014);
     		var cluster2015 = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});
     		cluster2015.addLayer(quakes2015);
     		
     		var quakesNone = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		}); 
     		
     		var quakestwentyfour = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});   
     		var quakesseven = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		}).addTo(map);
     		var quakesthirty = L.markerClusterGroup({
				iconCreateFunction: function (cluster) {
					var childCount = cluster.getChildCount();
					return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'quake-cluster', iconSize: new L.Point(40, 40) });
				}
     		});

     		

            var baseLayers = {
                "None" : quakesNone,
				"Past 24 Hours" : quakestwentyfour,
            	"Past 7 Days" : quakesseven,
            	"Past 30 Days" : quakesthirty
            	};
            	
            var overlays = {
				"2008" : cluster2008,
				"2009" : cluster2009,
				"2010" : cluster2010,
				"2011" : cluster2011,
				"2012" : cluster2012,
				"2013" : cluster2013,
				"2014" : cluster2014,
				"2015" : cluster2015,
				"Faults" : faults
				};

            L.control.layers(baseLayers, overlays).addTo(map);
            
			// Scale
			L.control.scale({position: 'topright'}).addTo(map);
			
			
			// Load in the data and style the popups     		
			function load1day(data) {
			    var quakes24 = L.geoJson(data, {
     		    	onEachFeature: function (feature, layer) {
     		    		temp = new Date(feature.properties.time);
         		    	layer.bindPopup("Date/Time: " + temp.toUTCString() + "</br>Magnitude: " + feature.properties.mag, {
         			    	autoPan: true
         				})
         			},
         			pointToLayer: function (feature, latlng) {
         		    	return L.circleMarker(latlng, {
         		        	radius: feature.properties.mag * 5,
         		        	fillColor: "#ff7800",
         		        	color: "#000"
        		    	}
     				)}
 	        	});
 	        	quakestwentyfour.addLayer(quakes24);
			};
			
			function load7days(data) {
			    var quakes7 = L.geoJson(data, {
     		    	onEachFeature: function (feature, layer) {
     		    		temp = new Date(feature.properties.time);
         		    	layer.bindPopup("Date/Time: " + temp.toUTCString() + "</br>Magnitude: " + feature.properties.mag, {
         			    	autoPan: true
         				})
         			},
         			pointToLayer: function (feature, latlng) {
         		    	return L.circleMarker(latlng, {
         		        	radius: feature.properties.mag * 5,
         		        	fillColor: "#ff7800",
         		        	color: "#000"
        		    	}
     				)}
 	        	});
 	        	quakesseven.addLayer(quakes7);
			};
					
			function load30days(data) {
			    var quakes30 = L.geoJson(data, {
     		    	onEachFeature: function (feature, layer) {
     		    		temp = new Date(feature.properties.time);
         		    	layer.bindPopup("Date/Time: " + temp.toUTCString() + "</br>Magnitude: " + feature.properties.mag, {
         			    	autoPan: true
         				})
         			},
         			pointToLayer: function (feature, latlng) {
         		    	return L.circleMarker(latlng, {
         		        	radius: feature.properties.mag * 5,
         		        	fillColor: "#ff7800",
         		        	color: "#000"
        		    	}
     				)}
 	        	});
 	        	quakesthirty.addLayer(quakes30);
			};
		</script>
	</body>
</html>